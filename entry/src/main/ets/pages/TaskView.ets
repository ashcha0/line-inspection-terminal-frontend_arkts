import router from '@ohos.router';
import promptAction from '@ohos.promptAction';
import { HttpUtil } from '../utils/HttpUtil';
import { AppConstants } from '../constants/AppConstants';

// ä»»åŠ¡æ¥å£
interface Task {
  id: number;
  taskNo: string;
  taskName: string;
  startLocation: string;
  endLocation: string;
  distance: number;
  creator: string;
  executor: string;
  status: string;
  createTime: string;
  remark?: string;
}

// æœç´¢æ¡ä»¶æ¥å£
interface SearchParams {
  taskNo?: string;
  creator?: string;
  executor?: string;
  status?: string;
}

// ä»»åŠ¡æ•°æ®æ¥å£
interface TaskData {
  taskName: string;
  taskNo?: string;
  startLocation: string;
  endLocation: string;
  distance: number;
  creator: string;
  executor: string;
  remark?: string;
}

@Entry
@Component
struct TaskView {
  @State tasks: Task[] = [];
  @State loading: boolean = true;
  @State showAddTask: boolean = false;
  @State searchParams: SearchParams = {};
  @State newTask: Partial<Task> = {};
  
  // æœç´¢è¡¨å•çŠ¶æ€
  @State searchTaskNo: string = '';
  @State searchCreator: string = '';
  @State searchExecutor: string = '';
  @State searchStatus: string = '';
  
  // æ–°å¢ä»»åŠ¡è¡¨å•çŠ¶æ€
  @State taskName: string = '';
  @State taskNo: string = '';
  @State startLocation: string = '';
  @State endLocation: string = '';
  @State distance: string = '';
  @State creator: string = '';
  @State executor: string = '';
  @State remark: string = '';

  aboutToAppear() {
    this.loadTasks();
  }

  async loadTasks(): Promise<void> {
    try {
      this.loading = true;
      let queryString = '';
      const params: string[] = [];
      
      if (this.searchParams.taskNo) {
        params.push(`taskNo=${encodeURIComponent(this.searchParams.taskNo)}`);
      }
      if (this.searchParams.creator) {
        params.push(`creator=${encodeURIComponent(this.searchParams.creator)}`);
      }
      if (this.searchParams.executor) {
        params.push(`executor=${encodeURIComponent(this.searchParams.executor)}`);
      }
      if (this.searchParams.status) {
        params.push(`status=${encodeURIComponent(this.searchParams.status)}`);
      }
      
      if (params.length > 0) {
        queryString = '?' + params.join('&');
      }
      
      const url = `/agv/task/list${queryString}`;
      const response = await HttpUtil.get(url);
      
      if (response.code === 200 && response.data && typeof response.data === 'object') {
        const data = response.data as Record<string, Object>;
        this.tasks = (data['rows'] as Task[]) || [];
      }
    } catch (error) {
      console.error('åŠ è½½ä»»åŠ¡åˆ—è¡¨å¤±è´¥:', error);
      promptAction.showToast({
        message: 'åŠ è½½ä»»åŠ¡åˆ—è¡¨å¤±è´¥',
        duration: 2000
      });
    } finally {
      this.loading = false;
    }
  }

  searchTasks() {
    this.searchParams = {
      taskNo: this.searchTaskNo || undefined,
      creator: this.searchCreator || undefined,
      executor: this.searchExecutor || undefined,
      status: this.searchStatus || undefined
    };
    this.loadTasks();
  }

  resetSearch() {
    this.searchTaskNo = '';
    this.searchCreator = '';
    this.searchExecutor = '';
    this.searchStatus = '';
    this.searchParams = {};
    this.loadTasks();
  }

  openAddTask() {
    this.clearTaskForm();
    this.showAddTask = true;
  }

  closeAddTask() {
    this.showAddTask = false;
    this.clearTaskForm();
  }

  clearTaskForm() {
    this.taskName = '';
    this.taskNo = '';
    this.startLocation = '';
    this.endLocation = '';
    this.distance = '';
    this.creator = '';
    this.executor = '';
    this.remark = '';
  }

  async addTask() {
    // è¡¨å•éªŒè¯
    if (!this.taskName || !this.startLocation || !this.endLocation || !this.distance || !this.creator || !this.executor) {
      promptAction.showToast({
        message: 'è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ',
        duration: 2000
      });
      return;
    }

    try {
      const taskData: TaskData = {
        taskName: this.taskName,
        taskNo: this.taskNo || undefined,
        startLocation: this.startLocation,
        endLocation: this.endLocation,
        distance: parseInt(this.distance),
        creator: this.creator,
        executor: this.executor,
        remark: this.remark || undefined
      };

      const response = await HttpUtil.post('/agv/task', taskData);
      
      if (response.code === 200) {
        promptAction.showToast({
          message: 'ä»»åŠ¡åˆ›å»ºæˆåŠŸ',
          duration: 2000
        });
        
        this.closeAddTask();
        this.loadTasks();
      }
    } catch (error) {
      console.error('åˆ›å»ºä»»åŠ¡å¤±è´¥:', error);
      promptAction.showToast({
        message: 'åˆ›å»ºä»»åŠ¡å¤±è´¥ï¼Œè¯·é‡è¯•',
        duration: 2000
      });
    }
  }

  async deleteTask(taskId: number) {
    try {
      const response = await HttpUtil.delete(`/agv/task/${taskId}`);
      
      if (response.code === 200) {
        promptAction.showToast({
          message: 'ä»»åŠ¡åˆ é™¤æˆåŠŸ',
          duration: 2000
        });
        
        this.loadTasks();
      }
    } catch (error) {
      console.error('åˆ é™¤ä»»åŠ¡å¤±è´¥:', error);
      promptAction.showToast({
        message: 'åˆ é™¤ä»»åŠ¡å¤±è´¥ï¼Œè¯·é‡è¯•',
        duration: 2000
      });
    }
  }

  async startTask(taskId: number) {
    try {
      const response = await HttpUtil.post(`/agv/task/start/${taskId}`);
      
      if (response.code === 200) {
        promptAction.showToast({
          message: 'ä»»åŠ¡å¯åŠ¨æˆåŠŸ',
          duration: 2000
        });
        
        // è·³è½¬åˆ°ä»»åŠ¡æ‰§è¡Œé¡µé¢
        router.pushUrl({
          url: 'pages/TaskExecuteView',
          params: {
            taskId: taskId
          }
        });
      }
    } catch (error) {
      console.error('å¯åŠ¨ä»»åŠ¡å¤±è´¥:', error);
      promptAction.showToast({
        message: 'å¯åŠ¨ä»»åŠ¡å¤±è´¥ï¼Œè¯·é‡è¯•',
        duration: 2000
      });
    }
  }

  viewTaskDetail(taskId: number) {
    router.pushUrl({
      url: 'pages/TaskDetailView',
      params: {
        taskId: taskId
      }
    });
  }

  getStatusColor(status: string): string {
    switch (status) {
      case AppConstants.TASK_STATUS.PENDING:
        return '#e6a23c';
      case AppConstants.TASK_STATUS.RUNNING:
        return '#409eff';
      case AppConstants.TASK_STATUS.UPLOADING:
        return '#909399';
      case AppConstants.TASK_STATUS.COMPLETED:
        return '#67c23a';
      default:
        return '#909399';
    }
  }

  getStatusText(status: string): string {
    switch (status) {
      case AppConstants.TASK_STATUS.PENDING:
        return 'å¾…å·¡è§†';
      case AppConstants.TASK_STATUS.RUNNING:
        return 'å·¡è§†ä¸­';
      case AppConstants.TASK_STATUS.UPLOADING:
        return 'å¾…ä¸Šä¼ ';
      case AppConstants.TASK_STATUS.COMPLETED:
        return 'å·²å®Œæˆ';
      default:
        return status;
    }
  }

  build() {
    Column() {
      // é¡µé¢æ ‡é¢˜
      Row() {
        Button('â† è¿”å›')
          .fontSize(14)
          .fontColor(AppConstants.COLORS.TEXT_PRIMARY)
          .backgroundColor('transparent')
          .onClick(() => {
            router.back();
          })
        
        Text('ä»»åŠ¡ç®¡ç†')
          .fontSize(20)
          .fontWeight(FontWeight.Bold)
          .layoutWeight(1)
          .textAlign(TextAlign.Center)
        
        Button('âš™ï¸')
          .fontSize(16)
          .fontColor(AppConstants.COLORS.TEXT_PRIMARY)
          .backgroundColor('transparent')
          .onClick(() => {
            promptAction.showToast({
              message: 'è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­',
              duration: 2000
            });
          })
      }
      .width('100%')
      .height(60)
      .padding({ left: 16, right: 16 })
      .backgroundColor('#ffffff')
      .border({ width: { bottom: 1 }, color: '#eeeeee' })

      // æœç´¢è¡¨å•
      Column() {
        Row() {
          Column() {
            Text('ä»»åŠ¡ç¼–å·')
              .fontSize(14)
              .fontColor(AppConstants.COLORS.TEXT_REGULAR)
              .margin({ bottom: 5 })
            TextInput({ placeholder: 'è¯·è¾“å…¥ä»»åŠ¡ç¼–å·' })
              .fontSize(14)
              .onChange((value: string) => {
                this.searchTaskNo = value;
              })
          }
          .layoutWeight(1)
          .alignItems(HorizontalAlign.Start)
          .margin({ right: 15 })

          Column() {
            Text('åˆ›å»ºäºº')
              .fontSize(14)
              .fontColor(AppConstants.COLORS.TEXT_REGULAR)
              .margin({ bottom: 5 })
            TextInput({ placeholder: 'è¯·è¾“å…¥åˆ›å»ºäºº' })
              .fontSize(14)
              .onChange((value: string) => {
                this.searchCreator = value;
              })
          }
          .layoutWeight(1)
          .alignItems(HorizontalAlign.Start)
          .margin({ right: 15 })

          Column() {
            Text('æ‰§è¡Œäºº')
              .fontSize(14)
              .fontColor(AppConstants.COLORS.TEXT_REGULAR)
              .margin({ bottom: 5 })
            TextInput({ placeholder: 'è¯·è¾“å…¥æ‰§è¡Œäºº' })
              .fontSize(14)
              .onChange((value: string) => {
                this.searchExecutor = value;
              })
          }
          .layoutWeight(1)
          .alignItems(HorizontalAlign.Start)
          .margin({ right: 15 })

          Column() {
            Text('çŠ¶æ€')
              .fontSize(14)
              .fontColor(AppConstants.COLORS.TEXT_REGULAR)
              .margin({ bottom: 5 })
            Select([{ value: 'å…¨éƒ¨' }, { value: 'å¾…å·¡è§†' }, { value: 'å·¡è§†ä¸­' }, { value: 'å¾…ä¸Šä¼ ' }, { value: 'å·²å®Œæˆ' }])
               .selected(0)
               .value('å…¨éƒ¨')
               .onSelect((index: number, value: string) => {
                 this.searchStatus = index === 0 ? '' : value;
               })
          }
          .layoutWeight(1)
          .alignItems(HorizontalAlign.Start)
          .margin({ right: 15 })

          Column() {
            Text(' ')
              .fontSize(14)
              .margin({ bottom: 5 })
            Row() {
              Button('æœç´¢')
                .fontSize(14)
                .fontColor('#ffffff')
                .backgroundColor(AppConstants.COLORS.PRIMARY)
                .border({ width: 1, color: AppConstants.COLORS.PRIMARY })
                .onClick(() => this.searchTasks())

              Button('é‡ç½®')
                .fontSize(14)
                .fontColor(AppConstants.COLORS.TEXT_PRIMARY)
                .backgroundColor('#ffffff')
                .border({ width: 1, color: '#dddddd' })
                .margin({ left: 10 })
                .onClick(() => this.resetSearch())
            }
          }
        }
        .width('100%')
        .alignItems(VerticalAlign.Bottom)
      }
      .width('100%')
      .padding(20)
      .backgroundColor('#fafafa')
      .border({ width: { bottom: 1 }, color: '#eeeeee' })

      // å·¥å…·æ 
      Row() {
        Button('ğŸ“¹ æ–°å¢ä»»åŠ¡')
          .fontSize(14)
          .fontColor('#ffffff')
          .backgroundColor(AppConstants.COLORS.PRIMARY)
          .border({ width: 1, color: AppConstants.COLORS.PRIMARY })
          .onClick(() => this.openAddTask())
      }
      .width('100%')
      .padding({ left: 20, right: 20, top: 15, bottom: 15 })
      .justifyContent(FlexAlign.Start)

      // ä»»åŠ¡åˆ—è¡¨
      if (this.loading) {
        Column() {
          LoadingProgress()
            .width(50)
            .height(50)
            .color(AppConstants.COLORS.PRIMARY)
          
          Text('åŠ è½½ä¸­...')
            .fontSize(14)
            .fontColor(AppConstants.COLORS.TEXT_REGULAR)
            .margin({ top: 10 })
        }
        .width('100%')
        .layoutWeight(1)
        .justifyContent(FlexAlign.Center)
        .alignItems(HorizontalAlign.Center)
      } else {
        List() {
          // è¡¨å¤´
          ListItem() {
            Row() {
              Text('ä»»åŠ¡ç¼–å·')
                .fontSize(14)
                .fontWeight(FontWeight.Bold)
                .fontColor(AppConstants.COLORS.TEXT_PRIMARY)
                .width(120)
                .textAlign(TextAlign.Center)
              
              Text('ä»»åŠ¡åç§°')
                .fontSize(14)
                .fontWeight(FontWeight.Bold)
                .fontColor(AppConstants.COLORS.TEXT_PRIMARY)
                .layoutWeight(1)
                .textAlign(TextAlign.Center)
              
              Text('èµ·å§‹åœ°ç‚¹')
                .fontSize(14)
                .fontWeight(FontWeight.Bold)
                .fontColor(AppConstants.COLORS.TEXT_PRIMARY)
                .width(100)
                .textAlign(TextAlign.Center)
              
              Text('ç»“æŸåœ°ç‚¹')
                .fontSize(14)
                .fontWeight(FontWeight.Bold)
                .fontColor(AppConstants.COLORS.TEXT_PRIMARY)
                .width(100)
                .textAlign(TextAlign.Center)
              
              Text('è·ç¦»(m)')
                .fontSize(14)
                .fontWeight(FontWeight.Bold)
                .fontColor(AppConstants.COLORS.TEXT_PRIMARY)
                .width(80)
                .textAlign(TextAlign.Center)
              
              Text('åˆ›å»ºäºº')
                .fontSize(14)
                .fontWeight(FontWeight.Bold)
                .fontColor(AppConstants.COLORS.TEXT_PRIMARY)
                .width(80)
                .textAlign(TextAlign.Center)
              
              Text('æ‰§è¡Œäºº')
                .fontSize(14)
                .fontWeight(FontWeight.Bold)
                .fontColor(AppConstants.COLORS.TEXT_PRIMARY)
                .width(80)
                .textAlign(TextAlign.Center)
              
              Text('çŠ¶æ€')
                .fontSize(14)
                .fontWeight(FontWeight.Bold)
                .fontColor(AppConstants.COLORS.TEXT_PRIMARY)
                .width(80)
                .textAlign(TextAlign.Center)
              
              Text('æ“ä½œ')
                .fontSize(14)
                .fontWeight(FontWeight.Bold)
                .fontColor(AppConstants.COLORS.TEXT_PRIMARY)
                .width(150)
                .textAlign(TextAlign.Center)
            }
            .width('100%')
            .height(50)
            .padding({ left: 15, right: 15 })
            .backgroundColor('#f8f9fa')
            .border({ width: { bottom: 1 }, color: '#eeeeee' })
          }

          // æ•°æ®è¡Œ
          ForEach(this.tasks, (task: Task, index: number) => {
            ListItem() {
              Row() {
                Text(task.taskNo)
                  .fontSize(14)
                  .fontColor(AppConstants.COLORS.PRIMARY)
                  .width(120)
                  .textAlign(TextAlign.Center)
                  .decoration({ type: TextDecorationType.Underline })
                  .onClick(() => this.viewTaskDetail(task.id))
                
                Text(task.taskName)
                  .fontSize(14)
                  .fontColor(AppConstants.COLORS.TEXT_PRIMARY)
                  .layoutWeight(1)
                  .textAlign(TextAlign.Center)
                
                Text(task.startLocation)
                  .fontSize(14)
                  .fontColor(AppConstants.COLORS.TEXT_PRIMARY)
                  .width(100)
                  .textAlign(TextAlign.Center)
                
                Text(task.endLocation)
                  .fontSize(14)
                  .fontColor(AppConstants.COLORS.TEXT_PRIMARY)
                  .width(100)
                  .textAlign(TextAlign.Center)
                
                Text(task.distance.toString())
                  .fontSize(14)
                  .fontColor(AppConstants.COLORS.TEXT_PRIMARY)
                  .width(80)
                  .textAlign(TextAlign.Center)
                
                Text(task.creator)
                  .fontSize(14)
                  .fontColor(AppConstants.COLORS.TEXT_PRIMARY)
                  .width(80)
                  .textAlign(TextAlign.Center)
                
                Text(task.executor)
                  .fontSize(14)
                  .fontColor(AppConstants.COLORS.TEXT_PRIMARY)
                  .width(80)
                  .textAlign(TextAlign.Center)
                
                Text(this.getStatusText(task.status))
                  .fontSize(12)
                  .fontColor('#ffffff')
                  .backgroundColor(this.getStatusColor(task.status))
                  .padding({ left: 8, right: 8, top: 4, bottom: 4 })
                  .borderRadius(12)
                  .width(80)
                  .textAlign(TextAlign.Center)
                
                Row() {
                  if (task.status === AppConstants.TASK_STATUS.PENDING) {
                    Button('å¯åŠ¨')
                      .fontSize(12)
                      .fontColor('#ffffff')
                      .backgroundColor(AppConstants.COLORS.SUCCESS)
                      .border({ width: 1, color: AppConstants.COLORS.SUCCESS })
                      .onClick(() => this.startTask(task.id))
                    
                    Button('åˆ é™¤')
                      .fontSize(12)
                      .fontColor('#ffffff')
                      .backgroundColor('#f56c6c')
                      .border({ width: 1, color: '#f56c6c' })
                      .margin({ left: 5 })
                      .onClick(() => this.deleteTask(task.id))
                  } else if (task.status === AppConstants.TASK_STATUS.UPLOADING) {
                    Button('ä¸Šä¼ ')
                      .fontSize(12)
                      .fontColor('#ffffff')
                      .backgroundColor(AppConstants.COLORS.PRIMARY)
                      .border({ width: 1, color: AppConstants.COLORS.PRIMARY })
                      .onClick(() => {
                        promptAction.showToast({
                          message: 'ä¸Šä¼ åŠŸèƒ½å¼€å‘ä¸­',
                          duration: 2000
                        });
                      })
                  } else {
                    Button('æŸ¥çœ‹')
                      .fontSize(12)
                      .fontColor(AppConstants.COLORS.TEXT_PRIMARY)
                      .backgroundColor('#ffffff')
                      .border({ width: 1, color: '#dddddd' })
                      .onClick(() => this.viewTaskDetail(task.id))
                  }
                }
                .width(150)
                .justifyContent(FlexAlign.Center)
              }
              .width('100%')
              .height(60)
              .padding({ left: 15, right: 15 })
              .backgroundColor(index % 2 === 0 ? '#ffffff' : '#f8f9fa')
              .border({ width: { bottom: 1 }, color: '#eeeeee' })
            }
          }, (task: Task) => task.id.toString())
        }
        .width('100%')
        .layoutWeight(1)
        .border({ width: 1, color: '#eeeeee' })
        .borderRadius(8)
        .margin({ left: 20, right: 20, bottom: 20 })
      }

      // æ–°å¢ä»»åŠ¡æ¨¡æ€æ¡†
      if (this.showAddTask) {
        Stack() {
          Column() {
            // æ¨¡æ€æ¡†æ ‡é¢˜
            Row() {
              Text('æ–°å¢ä»»åŠ¡')
                .fontSize(18)
                .fontWeight(FontWeight.Bold)
                .layoutWeight(1)
              
              Button('âœ•')
                .fontSize(16)
                .fontColor(AppConstants.COLORS.TEXT_REGULAR)
                .backgroundColor('transparent')
                .onClick(() => this.closeAddTask())
            }
            .width('100%')
            .padding(20)
            .border({ width: { bottom: 1 }, color: '#eeeeee' })

            // è¡¨å•å†…å®¹
            Scroll() {
              Column() {
                Row() {
                  Column() {
                    Text('ä»»åŠ¡åç§° *')
                      .fontSize(14)
                      .fontColor(AppConstants.COLORS.TEXT_REGULAR)
                      .margin({ bottom: 5 })
                    TextInput({ placeholder: 'è¯·è¾“å…¥ä»»åŠ¡åç§°' })
                      .fontSize(14)
                      .onChange((value: string) => {
                        this.taskName = value;
                      })
                  }
                  .layoutWeight(1)
                  .alignItems(HorizontalAlign.Start)
                  .margin({ right: 15 })

                  Column() {
                    Text('ä»»åŠ¡ç¼–å·')
                      .fontSize(14)
                      .fontColor(AppConstants.COLORS.TEXT_REGULAR)
                      .margin({ bottom: 5 })
                    TextInput({ placeholder: 'ç•™ç©ºè‡ªåŠ¨ç”Ÿæˆ' })
                      .fontSize(14)
                      .onChange((value: string) => {
                        this.taskNo = value;
                      })
                  }
                  .layoutWeight(1)
                  .alignItems(HorizontalAlign.Start)
                }
                .width('100%')
                .margin({ bottom: 20 })

                Row() {
                  Column() {
                    Text('èµ·å§‹åœ°ç‚¹ *')
                      .fontSize(14)
                      .fontColor(AppConstants.COLORS.TEXT_REGULAR)
                      .margin({ bottom: 5 })
                    TextInput({ placeholder: 'è¯·è¾“å…¥èµ·å§‹åœ°ç‚¹' })
                      .fontSize(14)
                      .onChange((value: string) => {
                        this.startLocation = value;
                      })
                  }
                  .layoutWeight(1)
                  .alignItems(HorizontalAlign.Start)
                  .margin({ right: 15 })

                  Column() {
                    Text('ç»“æŸåœ°ç‚¹ *')
                      .fontSize(14)
                      .fontColor(AppConstants.COLORS.TEXT_REGULAR)
                      .margin({ bottom: 5 })
                    TextInput({ placeholder: 'è¯·è¾“å…¥ç»“æŸåœ°ç‚¹' })
                      .fontSize(14)
                      .onChange((value: string) => {
                        this.endLocation = value;
                      })
                  }
                  .layoutWeight(1)
                  .alignItems(HorizontalAlign.Start)
                }
                .width('100%')
                .margin({ bottom: 20 })

                Row() {
                  Column() {
                    Text('ä»»åŠ¡è·ç¦»(ç±³) *')
                      .fontSize(14)
                      .fontColor(AppConstants.COLORS.TEXT_REGULAR)
                      .margin({ bottom: 5 })
                    TextInput({ placeholder: 'è¯·è¾“å…¥ä»»åŠ¡è·ç¦»' })
                      .fontSize(14)
                      .type(InputType.Number)
                      .onChange((value: string) => {
                        this.distance = value;
                      })
                  }
                  .layoutWeight(1)
                  .alignItems(HorizontalAlign.Start)
                  .margin({ right: 15 })

                  Column() {
                    Text('åˆ›å»ºäºº *')
                      .fontSize(14)
                      .fontColor(AppConstants.COLORS.TEXT_REGULAR)
                      .margin({ bottom: 5 })
                    TextInput({ placeholder: 'è¯·è¾“å…¥åˆ›å»ºäºº' })
                      .fontSize(14)
                      .onChange((value: string) => {
                        this.creator = value;
                      })
                  }
                  .layoutWeight(1)
                  .alignItems(HorizontalAlign.Start)
                }
                .width('100%')
                .margin({ bottom: 20 })

                Column() {
                  Text('æ‰§è¡Œäºº *')
                    .fontSize(14)
                    .fontColor(AppConstants.COLORS.TEXT_REGULAR)
                    .margin({ bottom: 5 })
                  TextInput({ placeholder: 'è¯·è¾“å…¥æ‰§è¡Œäºº' })
                    .fontSize(14)
                    .onChange((value: string) => {
                      this.executor = value;
                    })
                }
                .width('100%')
                .alignItems(HorizontalAlign.Start)
                .margin({ bottom: 20 })

                Column() {
                  Text('å¤‡æ³¨')
                    .fontSize(14)
                    .fontColor(AppConstants.COLORS.TEXT_REGULAR)
                    .margin({ bottom: 5 })
                  TextArea({ placeholder: 'è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯' })
                    .fontSize(14)
                    .height(80)
                    .onChange((value: string) => {
                      this.remark = value;
                    })
                }
                .width('100%')
                .alignItems(HorizontalAlign.Start)
              }
              .width('100%')
              .padding(20)
            }
            .layoutWeight(1)

            // æŒ‰é’®åŒºåŸŸ
            Row() {
              Button('å–æ¶ˆ')
                .fontSize(14)
                .fontColor(AppConstants.COLORS.TEXT_PRIMARY)
                .backgroundColor('#ffffff')
                .border({ width: 1, color: '#dddddd' })
                .onClick(() => this.closeAddTask())

              Button('ä¿å­˜')
                .fontSize(14)
                .fontColor('#ffffff')
                .backgroundColor(AppConstants.COLORS.PRIMARY)
                .border({ width: 1, color: AppConstants.COLORS.PRIMARY })
                .margin({ left: 15 })
                .onClick(() => this.addTask())
            }
            .justifyContent(FlexAlign.End)
            .width('100%')
            .padding(20)
          }
          .width(800)
          .height(600)
          .backgroundColor('#ffffff')
          .borderRadius(8)
          .shadow({ radius: 12, color: 'rgba(0,0,0,0.2)', offsetX: 0, offsetY: 4 })
        }
        .width('100%')
         .height('100%')
         .backgroundColor('rgba(0,0,0,0.5)')
         .onClick(() => this.closeAddTask())
      }
    }
    .width('100%')
    .height('100%')
    .backgroundColor(AppConstants.COLORS.BACKGROUND_BASE)
  }
}